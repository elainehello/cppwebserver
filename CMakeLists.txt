cmake_minimum_required(VERSION 3.16)

# Include Conan-generated toolchain file
include(${CMAKE_BINARY_DIR}/conan_toolchain.cmake OPTIONAL RESULT_VARIABLE CONAN_TOOLCHAIN_INCLUDED)
if(NOT CONAN_TOOLCHAIN_INCLUDED)
    message(FATAL_ERROR "Conan toolchain file not found. Did you run 'conan install ..' in the build directory?")
endif()

project(cppwebserver LANGUAGES CXX)

# Add include directory
include_directories(${CMAKE_SOURCE_DIR}/include)

# Add the executable target
add_executable(cppwebserver src/main.cpp src/server.cpp)

# Find packages generated by Conan
find_package(nlohmann_json REQUIRED)
find_package(spdlog REQUIRED)
find_package(cpprestsdk REQUIRED)
find_package(Crow REQUIRED)

# Link dependencies from Conan
target_link_libraries(cppwebserver PRIVATE nlohmann_json::nlohmann_json spdlog::spdlog cpprestsdk::cpprestsdk Crow::Crow)

# ADD the -include sctring flag to fix Boost memset issue
target_compile_options(cppwebserver PRIVATE -include cstring)